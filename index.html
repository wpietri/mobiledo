<!DOCTYPE html>
<html>
<head>
    <title>MobileDo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <script src="enyo/enyo.js"></script>
    <script>enyo.depends(
            // include support libraries
            "$lib/layout",
            "$lib/onyx"//,
            // include application sources
//            "css",
//            "models",
//            "controllers",
//            "views",
//            "apps",
            // include our default entry point
//            "start.js"
    );
    </script>
    <style>
        /*noinspection CssUnusedSymbol*/
        .todo_name {
            border:0;
            width:84%;
        }

    </style>
    <script>
        Array.prototype.remove = function(from, to) {
            var rest = this.slice((to || from) + 1 || this.length);
            this.length = from < 0 ? this.length + from : from;
            return this.push.apply(this, rest);
        };

        enyo.kind({
            name: "ToDoList",
            kind: "Control",
            popup: function (inSender, inEvent) {
                this.$.popup.selectedItemIndex = inEvent.index;
                this.$.popup.requestShowMenu();
            },
            components: [
                {name: "list", kind: "Repeater", onSetupItem: "setupItem",
                    components: [
                        {name: "item",
                            components: [
                                {kind: "enyo.Checkbox", name: "complete", onchange: "completeChanged"},
                                {tag: "span", content: " "},
                                {kind: "enyo.Input", name: "name", classes: "todo_name", oninput: "nameChanged", onhold: "popup"}
                            ]
                        }
                    ]},
                {kind: "onyx.MenuDecorator", name: "popup", components: [
                    {kind: "onyx.Menu", components: [
                        {content: "delete item", onSelect: "deleteSelected"}
                    ]}
                ]}
            ],
            deleteSelected: function (inSender, inEvent) {
                this.todos.remove(this.$.popup.selectedItemIndex);
                delete this.$.popup.selectedItemIndex;
                this.$.list.setCount(this.todos.length);
            },
            completeChanged: function (inSender, inEvent) {
                this.todos[event.index].complete = event.originator.checked;
            },
            nameChanged: function () {
                this.todos[event.index].name = event.originator.getValue();
            },
            setToDos: function (todos) {
                this.todos = todos;
                this.$.list.setCount(todos.length);
            },
            setupItem: function (inSender, inEvent) {
                var index = inEvent.index;
                var item = inEvent.item;
                var todo = this.todos[index];
                item.$.complete.checked = todo.complete;
                item.$.name.setValue(todo.name);
                return true;
            },
            addNew: function () {
                this.todos.push({complete: false, name: ""});
                this.$.list.setCount(this.todos.length);
                this.$.list.controlAtIndex(this.$.list.count - 1).$.name.focus();
            }
        });
        enyo.kind({
            name: "MobileDo.MainView",
            kind: "FittableRows",

            components: [{
                name: "toolbar",
                kind: "onyx.Toolbar",
                layoutKind: "FittableColumnsLayout",
                components: [
                    {content: "MobileDo", fit:true},
                    {kind: "onyx.Button", classes: "onyx-affirmative", content: "+", ontap: "newToDo"}
                ]
            }, {
                name: "todo_list",
                kind: "ToDoList",
                fit: true
            }, {
                kind: "onyx.Toolbar",
                components: []
            }],
            create: function() { this.inherited(arguments); this.$.todo_list.setToDos(this.initialToDos); },
            newToDo: function() { this.$.todo_list.addNew(); },

            initialToDos: [{complete:true, name: "Install MobileDo"}, {complete:false, name: "add some to-dos"}]
        });


        enyo.kind({
            name: "MobileDo.Application",
            kind: "enyo.Application",
            components: [],
            view: "MobileDo.MainView",
            handlers: {
            }
        });
        enyo.ready(function () {
            new MobileDo.Application({name: "app"});
        });



    </script>

</head>
<body>
<p>broken!</p>

</body>
</html>
